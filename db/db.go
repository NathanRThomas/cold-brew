/** ****************************************************************************************************************** **
	Generic database consts and structs

** ****************************************************************************************************************** **/

package db 

import (
	"coldbrew/tools"

	"github.com/pkg/errors"
	"github.com/google/uuid"

	"fmt"
	"log/slog"
)

  //-----------------------------------------------------------------------------------------------------------------------//
 //----- CONSTS ----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------//

const Salt = "e0f6235fc1d5b20d83cc"

var (
	ErrKeyNotFound 		= errors.New ("Key not found or has expired")
	ErrServiceDown 		= errors.New ("Database service is down")
)

  //-----------------------------------------------------------------------------------------------------------------------//
 //----- STRUCTS ---------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------//

type CacheObject interface {
	Key() string
	CacheTime() tools.TimeDuration
}

type DBStruct struct {
	Id *uuid.UUID 
}

func (this *DBStruct) PrefixKey (prefix string) string {
	if this == nil { return "" } // don't seg fault
	if this.Id == nil { return "" }
	return fmt.Sprintf("%s:%s", prefix, this.Id.String())
}

func (this *DBStruct) SetPK () {
	u := NewPK()
	this.Id = &u
}

  //-----------------------------------------------------------------------------------------------------------------------//
 //----- FUNCTIONS -------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------//

func NewPK () uuid.UUID {
	u, err := uuid.NewV7()
	if err != nil {
		slog.Error (err.Error(), "func", "NewPK")

		// that failed, so fallback to a v4
		u = uuid.New()
	}
	
	return u
}
